!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(i=i||self).Clipic=t()}(this,function(){"use strict";var i=function(){function n(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}return function(i,t,e){return t&&n(i.prototype,t),e&&n(i,e),i}}();return function(){function t(i){!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=i,this.init(),this.clipicFrame=this.getId("clipicFrame"),this.clipic=this.getId("clipic"),this.clipicCancel=this.getId("clipicCancel"),this.clipicImg=document.createElement("img"),this.clipicFrame.appendChild(this.clipicImg)}return i(t,[{key:"init",value:function(){this.createStyle(),this.createHtml()}},{key:"getId",value:function(i){return document.getElementById(i)}},{key:"createStyle",value:function(){var i=document.createElement("style");i.type="text/css";var t='\n      .clipic-body {\n        background: #1c1c1c;\n        position: fixed;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        transform: translate(0, 100%);\n        transition: 0.4s;\n        -webkit-touch-callout: none;\n        -webkit-user-select: none;\n        box-sizing: border-box;\n      }\n      .clipic-body * {\n        box-sizing: border-box;\n      }\n      .clipic-operation-bar {\n        display: flex;\n        color: #f2f2f2;\n        justify-content: space-between;\n        position: absolute;\n        width: 100%;\n        bottom: 0;\n        left: 0;\n      }\n      .clipic-operation-bar [role="button"] {\n        padding: 15px 20px;\n        font-size: 1em;\n      }\n      .clipic-frame {\n        height: 300px;\n        margin: 30px;\n        background: #f2f2f2;\n        overflow: hidden;\n      }\n      .clipic-frame img {\n      }\n      .clipic-cancel {\n        color: #3680fd;\n      }\n      .clipic-confirm{\n        color: #23c667;\n      }\n    '.trim();i.innerHTML=t,document.getElementsByTagName("HEAD").item(0).appendChild(i)}},{key:"createHtml",value:function(){var i=document.createElement("div");i.className="clipic-body",i.setAttribute("id","clipic");var t='\n      <div class="clipic-frame" id="clipicFrame"></div>\n      <div class="clipic-operation-bar">\n        <div class="clipic-cancel" id="clipicCancel" role="button">取消</div>\n        <div class="clipic-confirm" id="clipicConfirm" role="button">完成</div>\n      </div>\n    '.trim();i.innerHTML=t,document.body.appendChild(i)}},{key:"getImage",value:function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.scale=1,this.rotate=0,this.translateX=0,this.translateY=0,this.newOptions=Object.assign(this.options||{},i),this.newOptions.ratio=this.newOptions.ratio||this.newOptions.width/this.newOptions.height,this.clipicFrame.style.height=this.clipicFrame.clientWidth/this.newOptions.ratio+"px",this.clipicImg.src=this.newOptions.src,this.clipicImg.onload=function(){t.originW=t.clipicImg.width,t.originH=t.clipicImg.height,t.originRatio=t.originW/t.originH,t.initSize(),t.clipic.style.transform="translate(0, 0)",t.clipicCancel.addEventListener("click",function(){t.cancel()}),t.clipicImg.addEventListener("touchmove",function(i){t.setScale(i.touches[0],i.touches[1]),t.setRotate(i.touches[0],i.touches[1])}),t.clipicImg.addEventListener("touchend",function(i){t.distance=null,t.angle=null})}}},{key:"initSize",value:function(){this.newOptions.ratio>this.originRatio?(this.clipicImg.style.width=this.clipicFrame.clientWidth+"px",this.translate="translate(0, -"+(this.clipicImg.clientHeight-this.clipicFrame.clientHeight)/2+"px)"):(this.clipicImg.style.height=this.clipicFrame.clientHeight+"px",this.translate="translate(-"+(this.clipicImg.clientWidth-this.clipicFrame.clientWidth)/2+"px, 0)"),this.clipicImg.style.transform=this.translate}},{key:"setScale",value:function(i,t){if(i&&t){var e=Math.abs(i.clientX-t.clientX);this.distance&&(this.scale+=(e-this.distance)/this.clipicImg.clientWidth,this.setTransform()),this.distance=e}}},{key:"setRotate",value:function(i,t){if(i&&t){var e=Math.abs(i.clientX-t.clientX),n=Math.abs(i.clientY-t.clientY),c=180*Math.atan(e/n)/Math.PI;this.angle&&(this.rotate+=c-this.angle,this.setTransform()),this.angle=c}}},{key:"setTransform",value:function(){this.clipicImg.style.transform=this.translate+" scale("+this.scale+") rotate("+this.rotate+"deg)"}},{key:"cancel",value:function(){var i=this;this.clipic.style.transform="translate(0, 100%)",setTimeout(function(){i.clipicImg.style="",i.clipicImg.src=""},400)}}]),t}()});
